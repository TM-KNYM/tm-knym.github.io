<!DOCTYPE html>
<html class="no-js consumer" lang="en">
<head>
<meta charset="utf-8">
<title>FlashLight</title>
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script type='text/javascript' src="https://code.jquery.com/jquery-2.1.4.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/css/materialize.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.1/js/materialize.min.js">
</script>
<style>
body {
    display: flex;
    min-height: 100vh;
    flex-direction: column;
}
main {
    flex: 1 0 auto;
}
canvas#canvas{
    position: absolute; 
    z-index:2;
}
</style>
</head>
<body>

  </nav>
  <div class='container'>
      <div class="row">

        <div class="col s2">
            <br>
        </div>
        <div class="col s8">
          <div class="card blue-grey darken-1">
             <div class='row'>
              <canvas id='canvas'></canvas>
            <div class="card-image" id='div-canvas'>
              <img id='targetImg' src="https://c2.staticflickr.com/8/7304/16545889962_a0d110f185_z.jpg">
            </div>
             </div>
            <div class="card-action center">
                <div onclick="rec_voice()" class="btn-floating btn-large waves-effect waves-light red"><i class="material-icons">keyboard_voice</i></div>
            </div>
          </div>
          
        </div>
        <div class="col s2">
            <br>
        </div>
      </div>
  </div>
  <div class="footer-copyright center-align ">
    Â© 2014 Copyright Chiyuru
  </div>
<script>
/**
  *cull
  */
function Throttle(minInterval) {
   var _timeStamp = 0;
   function exec(func, e) {
        var now   = +new Date,
            delta = now - _timeStamp;
        if (delta >= minInterval) {
            _timeStamp = now;
            func(e);
        }
     }
   return {
        exec : exec
    };
}

function rec_voice(){

recognition.start();
}
/**
   draw canvas
  */
function draw(w,h){
	var canvas = document.getElementById('canvas');
	var ctx = canvas.getContext('2d');
    ctx.fillStyle = 'rgb(255,0,255)';
    ctx.fillRect(0, 0, w, h);
    var thr = new Throttle(100);
	canvas.onmousemove = mouseMoveListner;
	canvas.ontouchstart = mouseMoveListner;
    var _tempD = null;
    var _tempX = 0;
    var _tempY = 0;
	function mouseMoveListner(e) {
        thr.exec(function(e){
                if(_tempD !== null){
               ctx.putImageData(_tempD, _tempX, _tempY);
                }
               var wid = ht = 100;
               var rect = e.target.getBoundingClientRect();
               var mouseX = e.clientX - rect.left - wid/2;
               var mouseY = e.clientY - rect.top - ht/2;
               var imageData = ctx.getImageData(mouseX, mouseY, wid, ht); 
               _tempD = ctx.getImageData(mouseX, mouseY, wid, ht); 
               _tempX = mouseX;
               _tempY = mouseY;
               var d = imageData.data, i;
               for(i=0; i<d.length; i+=4)
                  d[i+3] = 0; 
               ctx.putImageData(imageData, mouseX, mouseY);
                },e);
	} 
}
document.body.addEventListener('touchstart', function(event) {
  event.preventDefault();
});
var recognition = new webkitSpeechRecognition();
recognition.lang = 'en-US';
  recognition.continuous = false;
  recognition.interimResults = true;

recognition.onstart = function(event){ 
    console.log("onstart", event);
}   ; 
recognition.onresult = function(event){
    alert(event.results.item(0).item(0).transcript)
};
 
var w = $('#targetImg').width();
var h = $('#targetImg').height();
$('#canvas').attr('width', w);
$('#canvas').attr('height', h);

draw(w,h);
</script>

</body>
</html>
